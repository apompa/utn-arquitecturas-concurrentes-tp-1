<!doctype html>
<html>
  <head>
    <title>PROFESOR</title>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <h1 id="title" class="title">[Profesor] ...</h1>
    <ul id="messages"></ul>

    <script src="socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      (function(){
        var socket = io("127.0.0.1:3000");
        var myself = {};
        var counter = 1;

        var $messages = $("#messages");
        
         var onMessage = function(message) {
            $messages.append($('<li>').text(message.text));
            $("html, body").scrollTop($messages.get(0).scrollHeight);
          };  
          
          socket.on('whoami', function(person) {
            myself = person;
            document.getElementById("title").innerHTML = "[Profesor] " + myself.name;
          });

          socket.on('student question', function(question) {
            var now = Date.now();
            var answer = {
              teacher: myself,
              question: question,
              text: '[' + now + '] "' + question.text + '" - Respuesta de ' + myself.name + ': NO.',
              timestamp: now
            };

            onMessage(question);
            if (counter % 5 === 0) {
              socket.emit('typing client', {
                question: question,
                text: 'Soy ' + myself.name + ' y estoy escribiendo una respuesta a "' + question.text + '"'
              });

              setTimeout(function() {
                socket.emit('teacher answer', answer);
              }, 1000);
            }
            counter++;
          });

          socket.on('teacher answer', onMessage);
          socket.on('typing server', onMessage);
        })();
    </script>
  </body>
</html>