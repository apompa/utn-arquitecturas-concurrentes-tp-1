<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <h1 id="title" class="title">Profesor</h1>
    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" />
      <button>Send</button>
    </form>
    <script src="socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      (function(){
        var socket = io("127.0.0.1:3000");
        var myself = {};
        var counter = 1;

        var $messages = $("#messages");
        
         var onMessage = function(msg) {
            $messages.append($('<li>').text(msg));
            $("html, body").scrollTop($messages.get(0).scrollHeight);
          };  
          
          socket.on('whoami', function(person) {
            myself = person;
            document.getElementById("title").innerHTML = myself.name;
          });

          socket.on('student question', function(question) {
            var answer = {
              teacher: myself,
              question: question,
              text: '"' + question + '" -> NO',
              timestamp: Date.now()
            };

            onMessage(question);
            if (counter % 5 === 0) {
              socket.emit('typing client', 'Estoy escribiendo una respuesta a "' + question + '"');

              setTimeout(function() {
                socket.emit('teacher answer', answer);
              }, 1000);
            }
            counter++;
          });

          socket.on('teacher answer', onMessage);
          socket.on('typing server', onMessage);
        })();
    </script>
  </body>
</html>